DECLARE @T TABLE (NAME VARCHAR (8000 ), TIME INT )

INSERT INTO @T 
SELECT '瘦人' , 1 UNION 
SELECT '小胖' , 3 UNION 
SELECT '姑娘' , 6 UNION 
SELECT '大胖' , 8 UNION 
SELECT '瘸子' , 12;

WITH T (FORWORD_NAME, TIME, PATH) AS
(
    SELECT REPLACE(A.NAME + B.NAME, C.NAME, ''), B.TIME + C.TIME, A.NAME + B.NAME + '过河→' + C.NAME + '返回→' 
      FROM @T A, @T B, @T C
     WHERE A.TIME < B.TIME
       AND CHARINDEX(C.NAME, A.NAME + B.NAME) > 0
     UNION ALL
    SELECT CASE WHEN LEN(FORWORD_NAME) < 6 THEN REPLACE(FORWORD_NAME + A.NAME + B.NAME, C.NAME, '') ELSE FORWORD_NAME + A.NAME + B.NAME END, 
           CASE WHEN LEN(FORWORD_NAME) < 6 THEN T.TIME + B.TIME + C.TIME ELSE T.TIME + B.TIME END, 
           CASE WHEN LEN(FORWORD_NAME) < 6 THEN PATH + A.NAME + B.NAME + '过河→' + C.NAME + '返回→' ELSE PATH + A.NAME + B.NAME + '过河→' END
      FROM @T A, @T B, @T C, T
     WHERE A.TIME < B.TIME
       AND CHARINDEX(C.NAME, FORWORD_NAME + A.NAME + B.NAME) > 0
       AND CHARINDEX(A.NAME, T.FORWORD_NAME) = 0 AND CHARINDEX (B.NAME, T.FORWORD_NAME) = 0
)
SELECT DISTINCT PATH , TIME FROM T WHERE LEN (FORWORD_NAME )= 10 AND TIME <= 30 